<!DOCTYPE HTML>
<html>
<head>
	<title>Unified bind/unbind methods</title>
	<script type="text/javascript" src="../../../tests/qunit/qunit-bootstrap.js"></script>
	<script type="text/javascript" src="../../../mwEmbedLoader.php"></script>
	<script type="text/javascript" src="../../../docs/js/doc-bootstrap.js"></script>
	<script type="text/javascript">	
		function jsVidiunPlayerTest( playerId ) {
			window[ 'playCount' ] = 0;
			window[ 'pauseCount' ] = 0;
			// Name this module
			module( "vBind / vUnbind" );
			var vdp = $( '#' + playerId ).get( 0 );
			test( "vBind :: Namespaced event ( doPlay.test ) + Global callback name", function() {
				window.doPlayCallback = function() {
					vdp.vUnbind( "doPlay.test", "doPlayCallback" );
					window[ 'playCount' ]++;
					ok( true, "doPlayCallback binded to doPlay.test" );
					playtest2();
					start();
				}
				vdp.vBind( "doPlay.test", "doPlayCallback" );
				vdp.sendNotification( "doPlay" );
				stop();
			} );
			window['playtest2'] = function(){
				test( "vBind :: Namespaced event ( doPause.test ) + Anonymous function", function() {
					stop();
					vdp.vBind( "doPause.test", function() {
						window[ 'pauseCount' ]++;
						ok( true, "Anonymous function binded to doPause.test" );
						playtest3();
						start();
					} );
					setTimeout( function() {
						vdp.sendNotification( "doPause" );
					}, 250 );
				} );
			}
			window['playtest3'] = function(){
				test( "vUnbind :: Whole Namespace ( .test )", function() {
					stop();
					var currentPauseCount = window[ 'pauseCount' ];
					var currentPlayCount = window[ 'playCount' ];
					vdp.vUnbind( ".test" );
					vdp.sendNotification( "doPlay" );
					equal( currentPlayCount, window[ 'playCount'], "Unbinded doPlay.test (Checking playCount value)" );
					setTimeout( function() {
						vdp.sendNotification( "doPause" );
						equal( currentPauseCount, window[ 'pauseCount'], "Unbinded doPause.test (Checking pauseCount value)" );
						playtest4();
						start();
					}, 250 );
				} );
			}
			window['playtest4'] = function(){
				test( "vBind :: Non-Namespaced Event ( doPlay ) + Global callback name", function() {
					stop();
					window.doPlayCallback = function() {
						vdp.vUnbind( "doPlay", "doPlayCallback" );
						window[ 'playCount' ]++;
						ok( true, "doPlayCallback binded to doPlay" );
						playtest5();
						start();
					}
					vdp.vBind( "doPlay", "doPlayCallback" );
					vdp.sendNotification( "doPlay" );
				} );
			}
			window['playtest5'] = function(){
				test( "vBind :: Non-Namespaced Event ( doPause ) + Anonymous function", function() {
					stop();
					vdp.vBind( "doPause", function() {
						window[ 'pauseCount' ]++;
						vdp.vUnbind("doPause");
						ok( true, "Anonymous function binded to doPause" );
						playtest6();
						start();
					} );
					setTimeout( function() {
						vdp.sendNotification( "doPause" );
					}, 250 );
				} );
			}
			window['playtest6'] = function(){
				test( "vUnbind :: Eventname ( doPlay / doPause )", function() {
					stop();
					var currentPlayCount = window[ 'playCount' ];
					var currentPauseCount = window[ 'pauseCount' ];		
					vdp.vUnbind( "doPlay" );
					vdp.vUnbind( "doPause" );
					vdp.sendNotification( "doPlay" );
					equal( currentPlayCount, window[ 'playCount'], "Unbinded doPlay (Checking playCount value)" );
					setTimeout( function() {
						vdp.sendNotification( "doPause" );
						equal( currentPauseCount, window[ 'pauseCount'], "Unbinded doPause (Checking pauseCount value)" );
						playtest7();
						start();
					}, 250 );
				} );
			}
			var runtbindOnce = false;
			window['playtest7'] = function(){
				test( "vUnbind :: Namespaced event ( doPlay.tounbind )", function() {
					stop();
					vdp.vBind( "doPlay.ns", function() {
						window[ 'playCount' ]++;
					} );
					vdp.vBind( "doPlay.tounbind", function() {
						window[ 'playCount' ] += 9;
					} );
					vdp.sendNotification( "doPlay" );
					var currentPlayCount = window[ 'playCount' ];
					vdp.vUnbind( "doPlay.tounbind" );
					setTimeout( function() {
						vdp.sendNotification( "doPause" );
						setTimeout( function() {
							vdp.sendNotification( "doPlay" );
							vdp.vUnbind( "doPlay.ns" );
							setTimeout( function() {
								if( runtbindOnce ){
									return ;
								}
								runtbindOnce = true;
								vdp.sendNotification( "doPause" );
								equal( ++currentPlayCount, window[ 'playCount'], "Unbinded doPlay.tounbind (Checking playCount value)" );
								
								playtest8();
								start();
							}, 250 );
						}, 250 );
					}, 250 );
				} );
			}
			var playtest8Active = true;
			window['playtest8'] = function(){
				test( "vUnbind :: Eventname ( doPlay ) + Non-existing global callback name / namespace", function() {
					vdp.vUnbind("doPlay");
					vdp.vBind( "doPlay", function() {
						if( playtest8Active ){
							window[ 'playCount' ]++;
						}
					} );
					vdp.vUnbind( "doPlay", "wrongName" );
					
					var currentPlayCount = window[ 'playCount' ];
					vdp.sendNotification( "doPlay" );
					equal( ++currentPlayCount, window[ 'playCount'], "doPlay was not unbound due to a non-existing global callback name (Checking playCount value)" );
					
					vdp.vUnbind( "doPlay.test" );
					vdp.sendNotification( "doPause" );
					vdp.sendNotification( "doPlay" );
					equal( ++currentPlayCount, window[ 'playCount'], "doPlay was not unbound due to a non-existing namespace (Checking playCount value)" );
					
					vdp.vUnbind( "doPlay" );
					vdp.sendNotification( "doPause" );
					playtest8Active = false;
					playtest9();
					start();
				} );
			}
			window['playtest9']= function(){
				test( "Chaining both functions", function() {
					vdp.vUnbind("doPlay").vBind( "doPlay.chaining", function() {
						window[ 'playCount' ]++;
					} );
					
					var currentPlayCount = window[ 'playCount' ];
					vdp.sendNotification( "doPlay" );
					//alert( 'currentPlayCount:' + currentPlayCount );
					equal( ++currentPlayCount, window[ 'playCount'], "Anonymous function binded to doPlay.chaining (Checking playCount value)" );
					vdp.vUnbind( ".chaining" ).vBind( "doPause.chaining", function() {
						window[ 'pauseCount' ]++;
					} );
					
					var currentPauseCount = window[ 'pauseCount' ];
					vdp.sendNotification( "doPause" );
					equal( ++currentPauseCount, window[ 'pauseCount'], "Anonymous function binded to doPause using chained form vUnbind().vBind() (Checking pauseCount value)" );
					equal( currentPlayCount, window[ 'playCount'], "Unbinded .chaining namespace using chained form vUnbind().vBind() (Checking playCount value)" );
					start();
				} );
			}
		}
	</script>

	<!-- qunit-vidiun must come after qunit-bootstrap.js and after mwEmbedLoader.php and after any jsCallbackReady stuff-->
	<script type="text/javascript" src="resources/qunit-vidiun-bootstrap.js"></script>
</head>
<body>
	<h2> Unified bind/unbind methods </h2>
	<h3> Simple binding for vidiun events.</h3>
	View the <a target="_blank" href="http://www.vidiun.org/demos/vdp3/docs.html">full list of events</a>
	<pre class="prettyprint linenums">
vWidget.addReadyCallback( function( playerId ){
	var vdp = document.getElementById( playerId );
	var foo = "bar";
	// Unlike addJsListener, you can directly issue local callbacks.
	vdp.vBind( &quot;doPlay.test&quot;, function(){ //notice the .test postfix namespaces the event)
		console.log(&quot;play &quot; + foo); // will log &quot;play bar&quot;
		//Now we can unbind our .test postfix via vUnbind ( only will log play once )
		vdp.vUnbind('.test')
	});
});
	</pre>
	
	<br />
	
	<div id="myVideoTarget" style="width: 400px; height: 330px"></div>
	<script>
		vWidget.embed({
			'targetId': 'myVideoTarget',
			'wid': '_243342',
			'uiconf_id' : '12905712',
			'entry_id' : '0_uka1msg4',
			'flashvars':{
				'externalInterfaceDisabled' : false
			},
			'readyCallback': function( playerId ) {
				console.log( playerId + ' is ready' );
			}
		} );
	</script>
</body>
</html>