<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Player Skin 2.0 + Test Page for PlayPauseBtn state changes with Ads + Sibling Disabled</title>
	<script type="text/javascript" src="../../../tests/qunit/qunit-bootstrap.js"></script>
	<script type="text/javascript" src="../../../mwEmbedLoader.php"></script>
	<script type="text/javascript" src="../../../docs/js/doc-bootstrap.js"></script>
	
	<script>mw.setConfig('forceMobileHTML5', true);</script>
	
	<script type="text/javascript">	
		function jsVidiunPlayerTest( videoId ){
			// Name this module
			module( "playPauseBtn state changing" );

			var vdp = $( '#' + videoId ).get( 0 );

			asyncTest("Ad started playback", function(){
				window[ 'onAdStart' ] = function( slot ){
						
					ok( true, "adStart event sent");
					runValidatePlayPauseBtnState();
					start();
				}
					
				vidiunQunitWaitForPlayer(function(){
				// Listen for ad start
					vdp.addJsListener('adStart', 'onAdStart');
				});
			});

		window[ 'runValidatePlayPauseBtnState' ] = function(){
			asyncTest( "Validate when player is playing ad playPause button is on pause icon", function(){
				equal("Pause clip", getPlayerBtn().title);
			
				start();

				vdp.addJsListener('adClick', 'onAdClick');
				vdp.addJsListener('playerPlayed', 'onPlayerPlayed');
				vdp.addJsListener('onEndedDone', 'onEndedDone');
			});
		}

		window[ 'onAdClick' ] = function(){
			asyncTest( "Validate when ad clicked playPause button is on play icon", function(){
				equal("Play clip", getPlayerBtn().title);
			
				start();
			});
		}

		window[ 'onPlayerPlayed' ] = function(){
			asyncTest( "Validate when player is playing entry playPause button is on pause icon", function(){
				equal("Pause clip", getPlayerBtn().title);
			
				start();

				vdp.removeJsListener('playerPlayed', 'onPlayerPlayed');
				vdp.addJsListener('doPlay', 'onDoPlay');
				vdp.addJsListener('doPause', 'onDoPause');
			});
		}

		window[ 'onDoPlay' ] = function(){
			asyncTest( "do play, playPause button is on pause icon", function(){
				equal("Play clip", getPlayerBtn().title);
			
				start();
			});
		}

		window[ 'onDoPause' ] = function(){
			asyncTest( "do pause, playPause button is on play icon", function(){
				equal("Pause clip", getPlayerBtn().title);
			
				start();
			});
		}

		window[ 'onEndedDone' ] = function(){
			vdp.removeJsListener('doPlay', 'onDoPlay');
			vdp.removeJsListener('doPause', 'onDoPause');

			asyncTest( "Validate icon changed to replay when entry ended", function(){
				equal("Replay", getPlayerBtn().title);
			
				start();
			});
		}
	}

	function getPlayerBtn() {
		var playerElement = $("#vidiun_player iframe").get(0).contentWindow.document;
		return playerElement.getElementsByClassName("playPauseBtn")[0];
	}
	</script>

	<!-- qunit-vidiun must come after qunit-bootstrap.js and after mwEmbedLoader.php and after any jsCallbackReady stuff-->
	<script type="text/javascript" src="../../VidiunSupport/tests/resources/qunit-vidiun-bootstrap.js"></script>
</head>
<body>
	<h1>Player Skin 2.0 + Test Page for PlayPauseBtn state changes with Ads + Sibling Disabled</h1>
	<br />
	<div id="vidiun_player" style="width: 300px; height: 330px;"></div>
	<br style="clear: both;" /><br />
<script>
	vWidget.featureConfig({
		'targetId': 'vidiun_player',
		'wid': '_243342',
		'uiconf_id' : '13306622',
		'entry_id' : '0_uka1msg4',
		'flashvars': {
			'vast': {
				'numPreroll':"1", 
				'prerollInterval':"1",
				'prerollStartWith':"1",
				'prerollUrl':"http://projects.vidiun.com/MichalR/vast3_demo.xml", 
				'overlayStartAt':"20",
				'overlayInterval':"300",
				'overlayUrl':"http://projects.vidiun.com/MichalR/vast_overlay.xml",
				'numPostroll':"1",
				'preSequence':"1",
				'postSequence':"1",
				'timeout':"4"
			},
			'adsOnReplay':true,
			"DisableVideoSibling":true
		}
	});
</script>
</body>
</html>