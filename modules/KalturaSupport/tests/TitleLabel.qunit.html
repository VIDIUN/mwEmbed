<!DOCTYPE HTML>
<html>
<head>
<title>Title player test</title>
<script type="text/javascript" src="../../../tests/qunit/qunit-bootstrap.js"></script>
<script type="text/javascript" src="../../../mwEmbedLoader.php"></script>
<script type="text/javascript" src="../../../docs/js/doc-bootstrap.js"></script>
<script type="text/javascript">	
function jsVidiunPlayerTest( videoId ){
	
	// Name this module
	module( "Title player" );

	var $iframe = $('#' + videoId + '_ifp').contents();
	var iframeContext = window.frames['vidiun_player_ifp'];
	var vdp = $('#' + videoId )[0];
	
	asyncTest( "Iframe in DOM", function() {
		ok( $('#' + videoId + '_ifp').length , 'iframe found' );
		equal( typeof iframeContext, 'object', "iframe JavaScript context available" );
		start();
	});
	
	asyncTest("Iframe layout elements", function(){
		vidiunQunitWaitForPlayer(function(){
			ok( $iframe.find('.largePlayBtn').length, ".largePlayBtn found" );
			ok( $iframe.find('.playPauseBtn').length, ".playPauseBtn found" );
			runTitleTest();
			start();
		});
	});
	
	function runTitleTest(){
		asyncTest("Title present", function(){
			// Test page context config: 
			ok( $iframe.find('.titleLabel').length, ".titleLabel found" );
			equal( $iframe.find('.titleLabel').text(), 
					vdp.evaluate('{mediaProxy.entry.name}'), 
					"Text title match" 
				);
			runLastTest();
			start();
		});
	}
	
	function runLastTest(){
		// change the video and confim the title updates
		asyncTest("Title changeMedia", function(){		
			window['vTestEntrySwitchReady'] = function(){
				// we have timeout since the at changeMedia time is used to update the interface
				setTimeout(function(){
					equal( vdp.evaluate( '{mediaProxy.entry.id}' ), "0_5diu7kzg", 'Switched entry to 0_5diu7kzg');
					equal( $iframe.find('.titleLabel').text(), 'Sample Vidiun Animated Logo', "Updated title" );
					start();					
				},10);
			};
			vdp.addJsListener( "changeMedia", "vTestEntrySwitchReady" );
			vdp.sendNotification( "changeMedia", { entryId : "0_5diu7kzg" } );
		});
	}

}
</script>
<!-- qunit-vidiun must come after qunit-bootstrap.js and after mwEmbedLoader.php and after any jsCallbackReady stuff-->
<script type="text/javascript" src="resources/qunit-vidiun-bootstrap.js"></script>
</head>
<body>
<h2> Title player test </h2>
<div id="vidiun_player" style="width:400px;height:330px;"></div>
<script>
	vWidget.featureConfig({
		'targetId': 'vidiun_player',
		'wid': '_243342',
		'uiconf_id': '5677072',
		'entry_id': '0_uka1msg4',
		'flashvars':{
			'titleLabel': {
				'plugin': true,
				"align": "left",
				"text": '{mediaProxy.entry.name}'
			}
		}
	});
</script>
</body>
</html>